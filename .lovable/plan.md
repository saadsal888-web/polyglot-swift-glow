

# نظام الجواهر ولوحة المتصدرين

## الوضع الحالي

- نظام الجواهر **موجود بالفعل** في `Lesson.tsx`: كل إجابة صحيحة = 2 جواهر + بونص للكومبو والسرعة
- جدول `leaderboard` موجود في الداتابيس فيه 10 بوتات بأسماء عربية/إنجليزية
- **لا توجد صفحة لوحة متصدرين** في التطبيق حالياً
- الجواهر تتحفظ في `user_progress.total_xp` لكن **لا تتزامن** مع جدول `leaderboard`

## التعديلات المطلوبة

### 1. مزامنة الجواهر مع لوحة المتصدرين

في `src/pages/Lesson.tsx` عند إكمال الدرس (شاشة النتائج):
- إضافة upsert لجدول `leaderboard` يحدّث `total_gems` و `lessons_completed` و `last_activity`
- يجلب اسم المستخدم من `profiles` للعرض

### 2. إنشاء صفحة لوحة المتصدرين الجديدة

ملف جديد: `src/pages/Leaderboard.tsx`

- عرض أعلى 50 لاعب مرتبين حسب `total_gems`
- تصميم البطاقات:
  - المراكز الثلاثة الأولى بتصميم مميز (ذهبي، فضي، برونزي)
  - باقي المراكز بتصميم موحد
- عرض رتبة المستخدم الحالي في الأسفل (حتى لو مش في الـ 50)
- نظام الدوريات المرئي:
  - برونزي (0+) / فضي (500+) / ذهبي (2000+) / ماسي (5000+)
  - شريط تقدم نحو الدوري التالي

### 3. تسجيل الراوت

في `src/App.tsx`:
- إضافة `/leaderboard` كراوت محمي

### 4. رابط من الصفحة الرئيسية

إضافة زر أو بطاقة في الصفحة الرئيسية للوصول السريع للوحة المتصدرين

## التفاصيل التقنية

| الملف | التغيير |
|---|---|
| `src/pages/Lesson.tsx` | إضافة upsert للـ leaderboard عند إكمال الدرس |
| `src/pages/Leaderboard.tsx` | ملف جديد - صفحة لوحة المتصدرين |
| `src/App.tsx` | إضافة راوت `/leaderboard` |
| `src/pages/Index.tsx` | إضافة زر/بطاقة للوحة المتصدرين |

### هيكل صفحة المتصدرين

```text
+---------------------------+
|   لوحة المتصدرين          |
+---------------------------+
|  [برونزي][فضي][ذهبي][ماسي] |  <-- فلتر الدوريات
+---------------------------+
|  1. نورة    6,200 جوهرة    |  <-- ذهبي مميز
|  2. Khalid  5,500 جوهرة    |  <-- فضي مميز  
|  3. محمد    4,800 جوهرة    |  <-- برونزي مميز
|  4. Sara    3,900 جوهرة    |
|  5. عبدالله  3,400 جوهرة   |
|  ...                       |
+---------------------------+
|  أنت: #15  120 جوهرة       |  <-- شريط ثابت
+---------------------------+
```

